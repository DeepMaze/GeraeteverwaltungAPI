#!/usr/bin/env node

var app = require('../app');
var http = require('http');

var normalizePort = require('../helpers/normalizePort');
var onError = require('../helpers/onError');
var onListening = require('../helpers/onListening');
var { createLog, handleOldLogs } = require('../helpers/logging');

var generalConfig = require('../environment/general');



var port = normalizePort(generalConfig.port);
app.set('port', port);

var server = http.createServer(app);

setInterval(() => {
    handleOldLogs();
}, 1000 * 60 * 60 * generalConfig.clearOldLogsInterval);

server.listen(port);
if (generalConfig.log) { createLog({ type: 'serverStart', params: { port } }); }

server.on('error', onError);
server.on('listening', onListening);